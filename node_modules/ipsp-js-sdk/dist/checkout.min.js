!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).$checkout=e()}(this,(function(){"use strict";function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var e={exports:{}},n={},i={},s={},r=function(t,e){if(!i[t])throw Error(["module is undefined",t].join(" "));return new i[t](e||{})};function o(t,e){return s[t]?s[t]:s[t]=r(t,e)}function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}o.get=function(t,e){return r(t,e)},o.add=function(t,e){return function(t,e){if(i[t])throw Error(["module already added",t].join(" "));i[t]=e}(t,e),this},n.Component=o;var h,u,d={},l=/^\d+$/,c=/([^\[\]]+)|(\[\])/g,p=/([^?#]*)(#.*)?$/,m=/%20/g,f=/\[\]$/,g=/\s([a-zA-Z]+)/,y=function(t){return decodeURIComponent(t.replace(/\+/g," "))},v=function t(e){var n=[];return A(e,(function(e){n=n.concat(E(e)?t(e):e)})),n},b=function t(e,n,i){E(n)?A(n,(function(s,r){f.test(e)?i(e,s):t(e+"["+(P(n)?r:"")+"]",s,i)})):P(n)?A(n,(function(n,s){t(e+"["+s+"]",n,i)})):i(e,n)},x=d.getType=function(t){return{}.toString.call(t).match(g)[1].toLowerCase()},P=d.isPlainObject=function(t){return!!t&&"object"===a(t)&&t.constructor===Object},w=d.isFunction=function(t){return"function"===x(t)},E=d.isArray=function(t){return"array"===x(t)},C=d.isElement=function(t){return t&&1===t.nodeType},_=d.toArray=function(t){return[].slice.call(t)},S=d.hasProp=function(t,e){return t&&t.hasOwnProperty(e)},A=d.forEach=function(t,e,n){for(var i in t)S(t,i)&&e.call(n||null,t[i],i)},k=d.cleanObject=function(t){for(var e in t)S(t,e)&&(0===t[e].length?(E(t)&&t.splice(e,1),P(t)&&delete t[e]):P(t[e])&&k(t[e]));return t},q=d.extend=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return A(n,(function(e){null!==e&&A(e,(function(e,n){P(e)?t[n]=q(t[n]||{},e):t[n]=e}))})),t},M=d.uuid=function(){for(var t=0,e="";t++<36;)e+=51*t&52?(15^t?8^Math.random()*(20^t?16:4):4).toString(16):"-";return e};d.isObject=function(t){return"object"===x(t)},d.isRegexp=function(t){return"regexp"===x(t)},d.isArguments=function(t){return"arguments"===x(t)},d.isError=function(t){return"error"===x(t)},d.isDate=function(t){return"date"===x(t)},d.isString=function(t){return"string"===x(t)},d.isNumber=function(t){return"number"===x(t)},d.map=function(t,e,n){var i,s,r=[];for(i in t)S(t,i)&&void 0!==(s=e.call(n||null,t[i],i))&&(r[i]=s);return r},d.querySelectorAll=function(t,e){return _((e||document).querySelectorAll(t))},d.querySelector=function(t,e){return(e||document).querySelector(t)},d.deparam=function(t){var e={};return"?"===t.charAt(0)&&(t=t.slice(1)),t&&p.test(t)&&A(t.split("&"),(function(t){var n=t.split("="),i=y(n.shift()),s=y(n.join("=")),r=e;if(i){for(var o=0,a=(n=i.match(c)).length-1;o<a;o++)r[n[o]]||(r[n[o]]=l.test(n[o+1])||"[]"===n[o+1]?[]:{}),r=r[n[o]];var h=n.pop();"[]"===h?r.push(s):r[h]=s}})),e},d.param=function(t){var e=[];return A(t,(function(t,n){b(n,t,(function(t,n){n=null==n?"":n,e.push([encodeURIComponent(t),encodeURIComponent(n)].join("="))}))})),e.join("&").replace(m,"+")},d.removeElement=function(t){t.parentNode.removeChild(t)},d.createElement=function(t){return document.createElement(t)},d.addClass=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=e.shift();if(!1!==C(i)){var s=i.className.trim().split(/\s+/);v(e.map((function(t){return t.trim().split(/\s+/)}))).forEach((function(t){t&&!~s.indexOf(t)&&s.push(t)})),i.className=s.join(" ").trim()}},d.removeClass=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=e.shift();if(!1!==C(i)){var s=i.className.trim().split(/\s+/);v(e.map((function(t){return t.trim().split(/\s+/)}))).forEach((function(t){if(t){var e=s.indexOf(t);~e&&s.splice(e,1)}})),i.className=s.join(" ").trim()}},d.removeAttr=function(t,e){if(!1===C(t))return!1;P(e)&&A(e,(function(e){t.removeAttribute(e)}))},d.addAttr=function(t,e){if(!1===C(t))return!1;P(e)&&A(e,(function(e,n){t.setAttribute(n,e)}))},d.getStyle=function(t,e,n){return((n=window.getComputedStyle)?n(t):t.currentStyle)[e.replace(/-(\w)/gi,(function(t,e){return e.toUpperCase()}))]},d.getPath=function(t){var e=t.split("."),n=e.shift(),i=null;return S(window,n)&&(i=window[n],A(e,(function(t){i=S(i,t)?i[t]:null}))),i},d.stringFormat=function(t,e,n){return(t||"").replace(n||/{(.+?)}/g,(function(t,n){return e[n]||t}))},d.cssUnit=function(t,e){return String(t||0).concat(e||"").concat(" !important")},d.getPaymentRequest=(h=window,S(h,"PaymentRequest")&&w(h.PaymentRequest)&&(u=h.PaymentRequest),function(t,e,n){var i=null;if((e=e||{}).id=M(),n=n||{},u)try{i=new u(t,e,n)}catch(t){i=null}return i}),d.jsonParse=function(t,e){try{return JSON.parse(t)}catch(t){return e}};var R={GooglePayApi:"https://pay.google.com/gp/p/js/pay.js",GoogleBaseRequest:{apiVersion:2,apiVersionMinor:0,allowedPaymentMethods:[{type:"CARD",parameters:{allowedAuthMethods:["PAN_ONLY","CRYPTOGRAM_3DS"],allowedCardNetworks:["AMEX","DISCOVER","INTERAC","JCB","MASTERCARD","VISA"]}}]},GooglePayLanguages:["ar","bg","ca","zh","hr","cs","da","nl","en","et","fi","fr","de","el","id","it","ja","ko","ms","no","pl","pt","ru","sr","sk","sl","es","sv","th","tr","uk"],PaymentRequestOptions:{},PaymentRequestDetails:{total:{label:"Total",amount:{currency:"USD",value:"0.00"}}},ApiFrameCss:{width:"1px !important",height:"1px !important",left:"1px !important",bottom:"1px !important",position:"fixed !important",border:"0px !important"},ButtonFrameCss:{border:"none !important",margin:"0 !important",padding:"0 !important",display:"block !important",width:"1px !important","min-width":"100% !important",background:"transparent !important",position:"relative !important",opacity:"0 !important",overflow:"hidden !important",height:"100% !important",outline:"none !important","z-index":"1 !important"},ButtonFrameAttrs:{tabindex:"-1",scrolling:"no",frameborder:0,allowtransparency:!0,allowpaymentrequest:!0},ButtonCoverCss:{"z-index":"2 !important",position:"absolute !important",border:"none !important",background:"transparent !important",left:"0 !important",top:"0 !important",cursor:"pointer !important",outline:"none !important",width:"100% !important",height:"100% !important"},ButtonCoverAttrs:{role:"button","aria-pressed":"false"},ButtonContainerCss:{border:"0 !important",margin:"0 !important",padding:"0 !important",display:"block !important",background:"transparent !important","user-select":"none !important",overflow:"hidden !important",position:"relative !important",opacity:"1 !important",height:"0 !important",width:"100% !important",outline:"none !important"},ButtonDefaultColor:"dark",ButtonColorMap:{dark:"dark",light:"light",black:"dark",white:"light"},ButtonLabelMap:{ar:"",bg:"",ca:"",zh:"",hr:"",cs:"",da:"",nl:"",en:"Pay with",et:"",es:"Comprar con",el:"",fi:"",fr:"Acheter avec",de:"Zahlen über",id:"",it:"Acquista con",ja:"",ko:"",ms:"",no:"",pl:"Zapłać przez",pt:"",ru:"Оплатить через",sr:"",sk:"Zaplatiť cez",sl:"",sv:"",th:"",tr:"",uk:"Оплатити через"}},j={},O={};d.isArray;var L=d.isFunction;d.hasProp;var D=d.forEach;O.Deferred=function(t){var e=[],n=[],i=[],s=0,r=null,o={done:function(t){return 1===s&&t.apply(this,r),e.push(t),this},fail:function(t){return 1===s&&t.apply(this,r),n.push(t),this},always:function(t){return this.done(t).fail(t)},progress:function(t){return 0===s&&i.push(t),this},then:function(t,e,n){return t&&this.done(t),e&&this.fail(e),n&&this.progress(n),this},promise:function(t){return null===t?o:(D(o,(function(e,n){t[n]=e})),t)},state:function(){return s},isPending:function(){return 0===s},isRejected:function(){return 2===s},isResolved:function(){return 1===s}},a={resolveWith:function(t,n){if(0===s){s=1;for(var i=r=n||[],o=0;o<e.length;o++)e[o].apply(t,i)}return this},rejectWith:function(t,e){if(0===s){s=2;for(var i=r=e||[],o=0;o<n.length;o++)n[o].apply(t,i)}return this},notifyWith:function(t,e){if(0===s)for(var n=r=e||[],o=0;o<i.length;o++)i[o].apply(t,n);return this},resetState:function(){return s=0,this},resolve:function(){return this.resolveWith(this,arguments)},reject:function(){return this.rejectWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)}},h=o.promise(a);return L(t)&&t.call(h,h),h};var T={},W={},B=!1,F=/xyz/.test(function(){return"xyz"}.toString())?/\b_super\b/:/.*/;function U(){}function z(t,e,n){return function(){var i,s=this._super;return this._super=t[e],i=n.apply(this,arguments),this._super=s,i}}U.prototype._super=function(){},U.prototype.instance=function(t){return new this.constructor(t)},U.prototype.proxy=function(t){return function(t,e){return function(){return e.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}}(this,t="string"==typeof t?this[t]:t)},U.extend=function t(e){function n(){!B&&this&&this.init.apply(this,arguments)}return n.prototype=function(t,e){var n,i,s=t.prototype;for(n in B=!0,i=new t,B=!1,e)e.hasOwnProperty(n)&&("function"==typeof s[n]&&"function"==typeof e[n]&&F.test(e[n])?i[n]=z(s,n,e[n]):i[n]=e[n]);return i}(this,e),n.prototype.constructor=n,n.extend=t,n},W.ClassObject=U;var N={},I=W.ClassObject;N.Event=I.extend({init:function(){this.events={},this.empty=[]},on:function(t,e){return(this.events[t]=this.events[t]||[]).push(e),this},off:function(t,e){t||(this.events={});for(var n=this.events[t]||this.empty,i=n.length=e?n.length:0;i--;)e===n[i]&&n.splice(i,1);return this},trigger:function(t){for(var e,n=this.events[t]||this.empty,i=n.length>0?n.slice(0,n.length):n,s=0;e=i[s++];)e.apply(e,this.empty.slice.call(arguments,1));return this}});var G=W.ClassObject,V=N.Event,J=d;T.Module=G.extend({utils:J,getListener:function(){return this._listener_||(this._listener_=new V),this._listener_},destroy:function(){this.off()},on:function(t,e){return this.getListener().on(t,e),this},off:function(t,e){return this.getListener().off(t,e),this},proxy:function(t){return this._proxy_cache_||(this._proxy_cache_={}),this.utils.isString(t)?(this._proxy_cache_[t]||(this._proxy_cache_[t]=this._super(t)),this._proxy_cache_[t]):this._super(t)},trigger:function(){return this.getListener().trigger.apply(this.getListener(),arguments),this},each:function(t,e){this.utils.forEach(t,this.proxy(e))},addAttr:function(t,e){if(!this.utils.isElement(t))return!1;this.utils.forEach(e,(function(e,n){t.setAttribute(n,e)}))},addCss:function(t,e){if(!this.utils.isElement(t))return!1;this.utils.forEach(e,(function(e,n){this.addCssProperty(t,n,e)}),this)},addCssProperty:function(t,e,n){var i,s=t.style.cssText.match(new RegExp("(?:[;\\s]|^)("+e.replace("-","\\-")+"\\s*:(.*?)(;|$))"));s?(i=s.index+s[0].indexOf(s[1]),t.style.cssText=t.style.cssText.substring(0,i)+e+": "+n+";"+t.style.cssText.substring(i+s[1].length)):t.style.cssText+=" "+e+": "+n+";"},addEvent:function(t,e,n){if(!t||!e||!n)return!1;n=this.proxy(n),t.addEventListener?t.addEventListener(e,n):t.attachEvent&&t.attachEvent("on"+e,n)},removeEvent:function(t,e,n){if(!t||!e||!n)return!1;n=this.proxy(n),t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent&&t.detachEvent("on"+e,n)},prepareForm:function(t,e,n,i){var s=this.utils.createElement("form");return this.addAttr(s,{action:t,target:n||"_self",method:i||"POST"}),this.addCss(s,{display:"none"}),this.utils.forEach(e,(function(t,e,n){(n=this.utils.createElement("input")).type="hidden",n.name=e,n.value=t,s.appendChild(n)}),this),s}});var $={},Z=T.Module;$.Connector=Z.extend({ns:"crossDomain",origin:"*",uniqueId:1,signature:null,init:function(t){this.setTarget(t.target),this.setOrigin(t.origin),this.create()},create:function(){this.addEvent(window,"message","router")},setOrigin:function(t){this.origin=t||"*"},setTarget:function(t){return this.target=t,this},getUID:function(){return++this.uniqueId},destroy:function(){this.removeEvent(window,"message","router"),this._super()},router:function(t,e,n){if(this.target!==e.source)return!1;try{n=JSON.parse(e.data)}catch(t){}n&&n.action&&n.data&&this.trigger(n.action,n.data)},send:function(t,e,n,i){if(this.target){n=JSON.stringify({action:t,data:e}),i={targetOrigin:this.origin,delegate:"payment"};try{this.target.postMessage(n,i)}catch(t){this.target.postMessage(n,this.origin,[])}}}});var H={},Y={},X={},K=function(t){return'\n<style>\n    .ipsp-modal {\n        box-sizing: border-box;\n        margin: 100px auto;\n        max-width: 680px;\n        background-color: #fff;\n        border-radius: 5px;\n        box-shadow: 0 2px 2px rgba(0, 0, 0, 0.2);\n        overflow: hidden;\n    }\n\n    @media (max-width: 850px) {\n        .ipsp-modal {\n            margin: 50px auto;\n        }\n    }\n\n    @media (max-width: 695px) {\n        .ipsp-modal {\n            max-width: 100%;\n            margin: 5px;\n        }\n    }\n\n    .ipsp-modal-wrapper {\n        box-sizing: border-box;\n        overflow: auto;\n        position: fixed;\n        z-index: 99999;\n        left: 0;\n        bottom: 0;\n        top: 0;\n        right: 0;\n        background-color: rgba(0, 0, 0, 0.2);\n    }\n\n    .ipsp-modal-header {\n        box-sizing: border-box;\n        background-color: #fafafa;\n        height: 50px;\n        box-shadow: 0 0 2px rgba(0, 0, 0, 0.2);\n        border-top-left-radius: 5px;\n        border-top-right-radius: 5px;\n    }\n\n    .ipsp-modal-close {\n        box-sizing: border-box;\n        float: right;\n        overflow: hidden;\n        height: 50px;\n        text-decoration: none;\n        border-top-right-radius: 5px;\n        color: #949494;\n    }\n\n    .ipsp-modal-close:hover, .ipsp-modal-close:focus, .ipsp-modal-close:active {\n        text-decoration: none;\n        color: #646464;\n    }\n\n    .ipsp-modal-close:before {\n        content: "×";\n        font-size: 50px;\n        line-height: 50px;\n        padding: 0 10px;\n    }\n\n    .ipsp-modal-title {\n        box-sizing: border-box;\n        border-top-left-radius: 5px;\n        line-height: 20px;\n        height: 50px;\n        padding: 5px 15px;\n        font-size: 12px;\n        display: table-cell;\n        vertical-align: middle;\n    }\n\n    .ipsp-modal-content {\n        box-sizing: border-box;\n        border-bottom-left-radius: 5px;\n        min-height: 650px;\n    }\n\n    .ipsp-modal-iframe {\n        overflow-x: hidden;\n        border: 0;\n        display: block;\n        width: 100%;\n        height: 750px;\n    }\n</style>\n'};X.acs=function(t){return"\n".concat(K(),'\n<div class="ipsp-modal-wrapper">\n    <div class="ipsp-modal">\n        <div class="ipsp-modal-header">\n            <a href="javascript:void(0)" class="ipsp-modal-close"></a>\n            <div class="ipsp-modal-title">\n                ').concat(t.messages.modalHeader,"\n                <a href='javascript:void(0)'>").concat(t.messages.modalLinkLabel,'</a>\n            </div>\n        </div>\n        <div class="ipsp-modal-content">\n            <iframe src="about:blank" class="ipsp-modal-iframe" frameborder="0" allowtransparency="true"></iframe>\n        </div>\n    </div>\n</div>\n')};var Q=W.ClassObject,tt=X;Y.Template=Q.extend({init:function(t){this.view=tt[t]||function(t){return function(e){return["template",t,"not found"].join(" ")}}(t)},render:function(t){return this.view(t)}});var et=T.Module,nt=$.Connector,it=Y.Template;H.Modal=et.extend({init:function(t){this.checkout=t.checkout,this.model=t.model||{},this.messages=t.checkout.params.messages||{},this.template=new it("acs"),this.body=this.utils.querySelector("body"),this.initModal(),this.initConnector()},initModal:function(){this.name=["modal-iframe",this.getRandomNumber()].join("-"),this.modal=this.utils.createElement("div"),this.modal.innerHTML=this.template.render({model:this.model,messages:this.messages}),this.iframe=this.find(".ipsp-modal-iframe"),this.addAttr(this.iframe,{name:this.name,id:this.name}),this.model.send_data?(this.form=this.prepareForm(this.model.url,this.model.send_data,this.name),this.modal.appendChild(this.form)):this.iframe.src=this.model.url,this.addEvent(this.find(".ipsp-modal-close"),"click","closeModal"),this.addEvent(this.find(".ipsp-modal-title a"),"click","submitForm"),this.initScrollbar(),this.body.appendChild(this.modal),this.form&&this.form.submit()},measureScrollbar:function(){var t=document.createElement("div");return t.className="modal-scrollbar-measure",this.body.appendChild(t),this.utils.removeElement(t),t.offsetWidth-t.clientWidth},checkScrollbar:function(){var t,e=window.innerWidth;e||(e=(t=document.documentElement.getBoundingClientRect()).right-Math.abs(t.left)),this.bodyIsOverflowing=document.body.clientWidth<e,this.scrollbarWidth=this.measureScrollbar()},initScrollbar:function(){this.checkScrollbar(),this.bodyPad=parseInt(this.utils.getStyle(this.body,"padding-right")||0,10),this.originalBodyPad=document.body.style.paddingRight||"",this.originalOverflow=document.body.style.overflow||"",this.bodyIsOverflowing&&this.addCss(this.body,{paddingRight:[this.bodyPad+this.scrollbarWidth,"px"].join(""),overflow:"hidden"})},resetScrollbar:function(){this.addCss(this.body,{paddingRight:this.originalBodyPad?[this.originalBodyPad,"px"].join(""):"",overflow:this.originalOverflow})},getRandomNumber:function(){return Math.round(1e9*Math.random())},find:function(t){return this.utils.querySelector(t,this.modal)},closeModal:function(t,e){e.preventDefault(),this.trigger("close",this.data),this.removeModal()},submitForm:function(t,e){e.preventDefault(),this.trigger("submit",this.data),this.addAttr(this.form,{target:"_blank"}),this.form.submit()},removeModal:function(){this.destroy()},destroy:function(){this.utils.removeElement(this.modal),this.resetScrollbar(),this.connector.destroy(),this._super()},initConnector:function(){this.connector=new nt({target:this.iframe.contentWindow}),this.connector.on("response",this.proxy("onResponse"))},onResponse:function(t,e){this.sendResponse(e),this.removeModal()},sendResponse:function(t){this.checkout.connector.send("request",{uid:t.uid,action:"api.checkout.proxy",method:"send",params:t})}});var st={},rt={},ot=T.Module;rt.Model=ot.extend({init:function(t){this.data=t||{},this.create()},create:function(){},eachProps:function(t){var e=t[1]?t[0]:null,n=t[1]?t[1]:t[0];return{list:e?this.alt(e,[]):this.data,callback:n}},each:function(){var t=this.eachProps(arguments);for(var e in t.list)t.list.hasOwnProperty(e)&&t.callback(this.instance(t.list[e]),t.list[e],e)},filter:function(){var t=this.eachProps(arguments);for(var e in t.list)if(t.list.hasOwnProperty(e)){var n=this.instance(t.list[e]);if(t.callback(n,t.list[e],e))return t.list[e]}},find:function(){var t=this.eachProps(arguments);for(var e in t.list)if(t.list.hasOwnProperty(e)){var n=this.instance(t.list[e]);if(t.callback(n,t.list[e],e))return n}return!1},alt:function(t,e){return void 0===(t=this.attr(t))?e:t},attr:function(t,e){for(var n=0,i=this.data,s=(t||"").split("."),r=s.pop(),o=arguments.length;n<s.length;n++)if(i&&i.hasOwnProperty(s[n]))i=i[s[n]];else{if(2!==o)break;i=i[s[n]]={}}return 1===o?i?i[r]:void 0:(2===o&&(i[r]=e),this)},stringify:function(){return JSON.stringify(this.serialize())},serialize:function(){return this.data}});var at=rt.Model,ht="http://secure-redirect.cloudipsp.com/submit/";st.Response=at.extend({stringFormat:function(t){var e=this;return(t||"").replace(/{(.+?)}/g,(function(t,n){return e.attr(["order.order_data",n].join("."))||t}))},setConnector:function(t){return this.connector=t,this},setUID:function(t){return this.uid=t,this},getUID:function(){return this.uid},formDataProxy:function(t,e,n,i){location.assign([ht,JSON.stringify({url:t,params:e,target:n,method:i})].join("#"))},formDataSubmit:function(t,e,n,i){if(t.match(/^http:/))return this.formDataProxy(t,e,n,i);var s=this.stringFormat(t),r=this.prepareForm(s,e,n,i);this.utils.querySelector("body").appendChild(r),r.submit(),r.parentNode.removeChild(r)},inProgress:function(){return this.attr("order.in_progress")},readyToSubmit:function(){return this.attr("order.ready_to_submit")},waitForResponse:function(){return this.attr("order.pending")},needVerifyCode:function(){return this.attr("order.need_verify_code")},redirectUrl:function(){return!!this.attr("url")&&(this.redirectToUrl(this.attr("url")),!0)},redirectToUrl:function(t){location.assign(t)},submitToMerchant:function(){var t=this.attr("order.ready_to_submit"),e=this.attr("model.url")||this.attr("order.response_url"),n=this.attr("order.method"),i=this.attr("order.action"),s=this.attr("model.send_data")||this.attr("order.order_data");if(t&&e&&s)return"redirect"===i||!0===s.get_without_parameters?this.redirectToUrl(e):this.formDataSubmit(e,s,"_self",n),!0},submitForm:function(){var t=this.attr("method"),e=this.attr("url"),n=this.attr("send_data");return!(!e||!n)&&(this.formDataSubmit(e,n,"_self",t),!0)},sendResponse:function(){var t=this.attr("action");return"submit"===t?this.submitForm():"redirect"===t&&this.redirectUrl()},prepare3dsData:function(){var t={},e=this.attr("submit3ds");return e["3ds"]&&(t.token=this.attr("token"),t.uid=this.getUID(),t.frame=!0,e.send_data.TermUrl&&(e.send_data.TermUrl=[e.send_data.TermUrl,this.utils.param(t)].join("#!!"))),e},waitOn3dsDecline:function(){var t=this.alt("submit3ds.checkout_data",{js_wait_on_3ds_decline:!1,js_wait_on_3ds_decline_duration:0});return t.js_wait_on_3ds_decline?t.js_wait_on_3ds_decline_duration:0},submit3dsForm:function(){this.attr("submit3ds.checkout_data")&&this.connector.trigger("modal",this.prepare3dsData())},supportedMethod:function(t){var e=this.find("methods",(function(e){return e.alt("supportedMethods","").match(t)}));e?this.attr("methods",[e.serialize()]):this.attr("methods",[])}});var ut=O.Deferred,dt=T.Module,lt=$.Connector,ct=H.Modal,pt=st.Response,mt=R.ApiFrameCss;j.Api=dt.extend({defaults:{origin:"https://api.fondy.eu",endpoint:{gateway:"/checkout/v2/index.html"},messages:{modalHeader:"Now you will be redirected to your bank 3DSecure. If you are not redirected please refer",modalLinkLabel:"link"}},init:function(t){this.initParams(t)},url:function(t,e){return[this.params.origin,this.params.endpoint[t]||"/",e||""].join("")},extendParams:function(t){return this.utils.extend(this.params,t),this},initParams:function(t){this.params=this.utils.extend({},this.defaults),this.extendParams(t),this.setOrigin(this.params.origin),this.loaded=!1,this.created=!1},setOrigin:function(t){return this.utils.isString(t)&&(this.params.origin=t),this},scope:function(t){t=this.proxy(t),!0===this._createFrame().loaded?t():this.on("checkout.api",t)},request:function(t,e,n){var i=ut(),s={uid:this.connector.getUID(),action:t,method:e,params:n||{}};return this.connector.send("request",s),this.connector.on(s.uid,this.proxy((function(t,e,n,r){var o=new pt(e);o.setUID(s.uid),o.setConnector(this.connector),r="resolveWith",o.attr("submit3ds")&&(r="notifyWith"),o.attr("error")&&(r="rejectWith"),i[r](this,[o])}))),i},_loadFrame:function(t){return this.iframe=this.utils.createElement("iframe"),this.addAttr(this.iframe,{allowtransparency:!0,frameborder:0,scrolling:"no"}),this.addAttr(this.iframe,{src:t}),this.addCss(this.iframe,mt),this.body=this.utils.querySelector("body"),this.body.firstChild?this.body.insertBefore(this.iframe,this.body.firstChild):this.body.appendChild(this.iframe),this.iframe},_createFrame:function(){return!1===this.created&&(this.created=!0,this.iframe=this._loadFrame(this.url("gateway")),this.connector=new lt({target:this.iframe.contentWindow,origin:this.params.origin}),this.connector.on("load",this.proxy("_onLoadConnector")),this.connector.on("modal",this.proxy("_onOpenModal"))),this},_onOpenModal:function(t,e){this.modal=new ct({checkout:this,model:e}),this.modal.on("close",this.proxy("_onCloseModal"))},_onCloseModal:function(t,e){this.trigger("modal.close",t,e)},_onLoadConnector:function(){this.loaded=!0,this.connector.off("load"),this.trigger("checkout.api"),this.off("checkout.api")}});var ft={},gt={},yt={},vt=O.Deferred,bt=T.Module,xt=R.GooglePayApi,Pt=R.GoogleBaseRequest,wt=bt.extend({id:"google-payments-api",init:function(){this.client=null,this.wrapper=this.utils.querySelector("head"),this.defer=vt()},load:function(){return this.utils.getPath("google.payments.api.PaymentsClient")?this.defer.resolveWith(this):(this.utils.querySelector("#".concat(this.id))||(this.script=this.utils.createElement("script"),this.addAttr(this.script,{id:this.id,async:!0,src:xt}),this.utils.isElement(this.wrapper)&&this.wrapper.appendChild(this.script),this.addEvent(this.script,"load","onLoadSuccess"),this.addEvent(this.script,"error","onLoadError")),this.defer)},show:function(t){var e=t.find((function(t){return"https://google.com/pay"===t.supportedMethods}));return this.getClient({environment:e.data.environment}).loadPaymentData(e.data)},readyToPay:function(t,e){e.result&&this.defer.resolveWith(this)},onError:function(t,e){this.defer.rejectWith(this,e)},onLoadSuccess:function(){var t=this.getClient();t&&t.isReadyToPay(Pt).then(this.proxy("readyToPay")).catch(this.proxy("onError"))},onLoadError:function(){this.defer.rejectWith(this)},getClient:function(t){if(t||null===this.client){var e=this.utils.getPath("google.payments.api.PaymentsClient");e?this.client=new e(t):this.onError(null,new Error("Google Client Error"))}return this.client}});yt.GooglePay=new wt;var Et=T.Module,Ct=j.Api,_t=yt.GooglePay,St=O.Deferred,At=d.getPaymentRequest,kt=d.hasProp,qt=d.isFunction,Mt=R.GoogleBaseRequest,Rt=R.PaymentRequestDetails,jt=null,Ot={fallback:!1,provider:[]},Lt=function(){if(jt)return jt;jt=St();var t=[["google",{supportedMethods:"https://google.com/pay",data:Mt}],["apple",{supportedMethods:"https://apple.com/apple-pay"},function(){return kt(window,"ApplePaySession")}]],e=Rt;return function n(){var i=t.shift();if(void 0===i)return-1===Ot.provider.indexOf("google")&&(Ot.fallback=!0,Ot.provider.push("google")),jt.resolve(Ot);var s=i.shift(),r=i.shift(),o=i.shift();if(qt(o)&&!1===o())return setTimeout(n,25),!1;var a=At([r],e,{});a?a.canMakePayment().then((function(t){!0===t&&Ot.provider.push(s),setTimeout(n,25)})).catch((function(){setTimeout(n,25)})):setTimeout(n,25)}(),jt},Dt=Et.extend({config:{payment_system:"",fallback:!1,methods:[],details:{},options:{}},supported:{fallback:!1,provider:[]},payload:{payment_system:null,provider:[]},params:{},getSupportedMethods:function(){var t=this;return Lt().then((function(e){return t.setSupported(e),e}))},init:function(t){this.params=t||{}},setSupported:function(t){return this.supported=t,this.trigger("supported",t),this},setPayload:function(t){return this.payload=t,this.trigger("payload",t),this},setMerchant:function(t){this.merchant=t},setApi:function(t){return t instanceof Ct&&(this.api=t),this},getProviderPayload:function(t){return this.payload.provider[t]||{}},isMethodSupported:function(t){return-1!==this.supported.provider.indexOf(t)},isFallbackMethod:function(t){return"google"===t&&this.supported.fallback}}),Tt=Dt.extend({request:function(t,e,n,i){this.api&&this.api.scope(this.proxy((function(){this.api.request("api.checkout.pay",t,e).done(this.proxy(n)).fail(this.proxy(i))})))},update:function(t){this.request("methods",t,"onUpdate","onError")},onUpdate:function(t,e){this.setPayload(e.serialize())},onError:function(t,e){this.trigger("error",e)},isPending:function(){return!0===this.pendingState},setPending:function(t){var e=this;this.pendingState=t,setTimeout((function(){e.trigger("pending",t)}),100)},pay:function(t){if(!this.isPending()){this.setPending(!0);var e=this.getProviderPayload(t),n=St();return n.always((function(){this.setPending(!1)})),!1===this.isMethodSupported(t)?n.rejectWith(this,[{test:!0}]):(this.isFallbackMethod(t)?this.makePaymentFallback(n,e.methods):this.makeNativePayment(n,e),n.done((function(t){this.trigger("details",{payment_system:this.payload.payment_system,data:t})})).fail((function(t){this.trigger("error",t),!0===this.params.embedded&&(location.reload(),this.trigger("reload",this.params))})))}},makeNativePayment:function(t,e){var n=this,i=At(e.methods,e.details,e.options);this.addEvent(i,"merchantvalidation","merchantValidation"),i.canMakePayment().then((function(){i.show().then((function(e){e.complete("success").then((function(){t.resolveWith(n,[e.details])}))})).catch((function(e){t.rejectWith(n,[{code:e.code,message:e.message}])}))})).catch((function(e){t.rejectWith(n,[{code:e.code,message:e.message}])}))},makePaymentFallback:function(t,e){var n=this;_t.load().then((function(){_t.show(e).then((function(e){t.resolveWith(n,[e])})).catch((function(e){t.rejectWith(n,[{code:e.code,message:e.message}])}))}))},appleSession:function(t){var e=St();return this.request("session",t,(function(t,n){e.resolveWith(this,[n.serialize()])}),(function(t,n){e.rejectWith(this,[n])})),e},merchantValidation:function(t,e){var n=e.validationURL,i=location.host;this.appleSession({url:n,domain:i,merchant_id:this.merchant}).done((function(t){try{e.complete(t.data)}catch(t){this.trigger("error",t)}})).fail((function(t){this.trigger("error",t)}))}});gt.PaymentRequestApi=Tt;var Wt={},Bt=T.Module,Ft=$.Connector,Ut=R.ButtonContainerCss,zt=R.ButtonCoverCss,Nt=R.ButtonCoverAttrs,It=R.ButtonFrameCss,Gt=R.ButtonFrameAttrs,Vt=gt.PaymentRequestApi;Wt.PaymentElement=Bt.extend({defaults:{method:null,appendTo:null,className:"payment-element",origin:"https://pay.fondy.eu",endpoint:"/latest/checkout/v2/button/element.html",mode:"plain",color:"black",lang:"en",height:38},init:function(t){this.params={},this.utils.extend(this.params,this.defaults),this.utils.extend(this.params,t),this.initElement()},getElementUrl:function(){return[this.params.origin,this.params.endpoint].join("")},getElementOptions:function(){return this.utils.param({method:this.params.method,mode:this.params.mode,style:this.params.style,color:this.params.color,lang:this.params.lang})},initElement:function(){this.element=this.utils.createElement("div"),this.iframe=this.utils.createElement("iframe"),this.button=this.utils.createElement("a"),this.addCss(this.element,Ut),this.addCss(this.button,zt),this.addAttr(this.button,Nt),this.addCss(this.iframe,It),this.addAttr(this.iframe,Gt),this.addAttr(this.iframe,{src:[this.getElementUrl(),this.getElementOptions()].join("?")}),this.addEvent(this.iframe,"load","onloadConnector"),this.addEvent(this.iframe,"error","errorConnector"),this.addAttr(this.element,{class:this.params.className}),this.element.appendChild(this.iframe),this.element.appendChild(this.button)},errorConnector:function(){log("frame load error")},onloadConnector:function(){this.connector=new Ft({target:this.iframe.contentWindow,origin:this.params.origin})},send:function(t,e){this.connector&&this.connector.send(t,e)},onEvent:function(t,e){if(e.preventDefault(),this.pending)return!1;this.send("event",{type:e.type})},onClick:function(){if(this.pending)return!1;this.request.pay(this.params.method)},onSupported:function(t,e){e.provider.includes(this.params.method)&&this.mount()},onPayload:function(t,e){e.allowed.includes(this.params.method)&&this.show()},onPending:function(t,e){this.pending=e,this.send("pending",{state:e})},initEvents:function(){this.addEvent(this.button,"mouseenter","onEvent"),this.addEvent(this.button,"mouseleave","onEvent"),this.addEvent(this.button,"blur","onEvent"),this.addEvent(this.button,"focus","onEvent"),this.addEvent(this.button,"click","onClick")},setPaymentRequest:function(t){if(!(t instanceof Vt))throw Error("request is not instance of PaymentRequestApi");this.request=t;var e=this.proxy("onSupported"),n=this.proxy("onPayload"),i=this.proxy("onPending");return this.request.off("supported",e).on("supported",e),this.request.off("payload",n).on("payload",n),this.request.off("pending",i).on("pending",i),this},appendTo:function(t){var e=this.utils.querySelector(t);return e&&e.appendChild(this.element),this.initEvents(),this},mount:function(){this.appendTo(this.params.appendTo)},isMounted:function(){return document.body.contains(this.element)},show:function(){return!1===this.isMounted()||(this.addCss(this.iframe,{transition:"opacity 0.6s 0.4s ease-out",opacity:this.utils.cssUnit(1)}),this.addCss(this.element,{transition:"height 0.2s ease-out",height:this.utils.cssUnit(this.params.height,"px")}),this.trigger("show",{})),this},hide:function(){return!1===this.isMounted()||(this.addCss(this.iframe,{transition:"opacity 0.4s ease-out",opacity:this.utils.cssUnit(0)}),this.addCss(this.element,{transition:"height 0.2s 0.4s ease-out",height:this.utils.cssUnit(0,"px")}),this.trigger("hide",{})),this}});var Jt=T.Module,$t=j.Api,Zt=gt.PaymentRequestApi,Ht=Wt.PaymentElement,Yt=d.forEach;ft.PaymentButton=Jt.extend({defaults:{origin:"https://api.fondy.eu",methods:["apple","google"],element:null,style:{height:38,mode:"default",type:"long",color:"black"},data:{lang:"en"}},init:function(t){this.elements={},this.supported=!1,this.params={element:t.element,methods:t.methods||this.defaults.methods,origin:t.origin||this.defaults.origin,endpoint:this.utils.extend({},this.defaults.endpoint,t.endpoint),style:this.utils.extend({},this.defaults.style,t.style),data:this.utils.extend({},this.defaults.data,t.data)},this.initApi(t.api),this.initPaymentRequestApi(),this.initElements(),this.update()},initApi:function(t){this.api=t instanceof $t?t:new $t({origin:this.params.origin,endpoint:this.params.endpoint})},initPaymentRequestApi:function(){this.request=new Zt,this.request.setApi(this.api),this.request.setMerchant(this.params.data.merchant_id),this.request.getSupportedMethods(),this.request.on("details",this.proxy("onDetails")),this.request.on("error",this.proxy("onError"))},initElements:function(){var t=this.params.style,e=this.params.data,n=this.params.origin,i=this.params.element,s=this.request;this.container=this.utils.querySelector(this.params.element),this.addCss(this.container,{display:"flex",gap:"1rem","flex-direction":"column"}),Yt(this.params.methods,(function(r){new Ht({origin:n,method:r,appendTo:i,color:t.color,mode:t.mode,lang:e.lang,height:t.height}).setPaymentRequest(s)}))},update:function(t){var e=this.utils.extend(this.params.data,t||{});this.request.update(e)},onDetails:function(t,e){var n=this,i=this.utils.extend({},this.params.data,e);this.api.scope((function(){n.api.request("api.checkout.form","request",i).done(n.proxy("onSuccess")).fail(n.proxy("onError"))}))},onSuccess:function(t,e){this.trigger("success",e)},onError:function(t,e){this.trigger("error",e)}});var Xt={},Kt=T.Module,Qt=$.Connector,te=gt.PaymentRequestApi,ee=R.GooglePayLanguages,ne=R.ButtonColorMap,ie=R.ButtonDefaultColor,se=R.ButtonLabelMap;Xt.PaymentContainer=Kt.extend({defaults:{element:null,method:"card",data:{lang:"en"},style:{}},init:function(t){this.initParams(t),this.initEvents()},initParams:function(t){this.params=this.utils.extend({},this.defaults,t),this.element=this.utils.querySelector(this.params.element),this.connector=new Qt({target:window.parent}),this.payment=new te({embedded:!0})},extendParams:function(t){this.utils.extend(this.params,{method:t.method,style:t.style,data:t.data,css:t.css})},getGoogleLangSupport:function(t,e){return-1!==ee.indexOf(t)?t:e},getButtonColor:function(t){return ne[t]||ie},getGoogleSvg:function(t,e,n){var i={endpoint:"https://www.gstatic.com/instantbuy/svg",color:this.getButtonColor(t),mode:n||"plain",lang:e||"en"},s='url("{endpoint}/{color}/{mode}/{lang}.svg")';return"plain"===n&&(s='url("{endpoint}/{color}_gpay.svg")'),"buy"===n&&(s='url("{endpoint}/{color}/{lang}.svg")'),this.utils.stringFormat(s,i)},getAppleSvg:function(t){var e={color:this.getButtonColor(t)};return this.utils.stringFormat('url("svg/apple-pay-{color}.svg")',e)},getAppleLabel:function(t){return se[t||"en"]},addFrameImage:function(){var t=this.utils.querySelector("iframe",this.element)||this.utils.createElement("iframe"),e=this.params.style||{},n=this.getGoogleLangSupport(this.params.data.lang,"en"),i={buttonColor:e.color||"black",browserLocale:n,buttonSizeMode:"fill"},s=["https://pay.google.com/gp/p/generate_gpay_btn_img",this.utils.param(i)].join("?");this.addAttr(t,{scrolling:"no",frameborder:0,src:s}),this.element.appendChild(t),this.element.classList.remove("short","long")},styleButton:function(){var t=this.element,e=this.params,n=e.method,i=e.style||{},s=e.data.lang||"en",r=e.css||{};t.setAttribute("class",""),t.classList.add("button","pending"),"card"===n&&(n="google"),n&&t.classList.add(n),s&&t.classList.add(s),i.type&&t.classList.add(i.type),i.mode&&t.classList.add(i.mode),i.color&&t.classList.add(i.color),"google"===n&&("short"===i.type&&(i.mode="plain"),"default"===i.mode?this.addFrameImage():r.image=this.getGoogleSvg(i.color,s,i.mode)),"apple"===n&&(r.image=this.getAppleSvg(i.color),r.label=this.getAppleLabel(s,i.mode)),r&&this.utils.forEach(r,(function(e,n){t.style.setProperty(["--",n].join(""),e)}))},initEvents:function(){this.payment.on("details",this.proxy((function(t,e){this.connector.send("details",e),this.connector.send("complete",e)}))),this.payment.on("reload",this.proxy((function(t,e){this.connector.send("reload",e)}))),this.payment.on("error",this.proxy((function(t,e){this.connector.send("error",e)}))),this.connector.on("options",this.proxy((function(t,e){this.extendParams(e),this.styleButton()}))),this.connector.on("pay",this.proxy((function(){if(!this.element.classList.contains("pending"))if("apple"===this.params.method){var t=this.payment.payload||{},e=t.provider.apple||{};this.connector.send("pay",{payment_system:t.payment_system,methods:e.methods,details:e.details,options:e.options})}else this.payment.setSupported({fallback:!1,provider:["google"]}).pay("google")}))),this.connector.on("config",this.proxy((function(t,e){this.payment.setPayload(e=function(t){var e={payment_system:t.payment_system,provider:{}},n=t.methods||[],i=t.details||{},s=t.options||{},r=new RegExp("//([a-z]+)\\.com/");return n.forEach((function(t){var n=r.exec(t.supportedMethods);null!==n&&(e.provider[n[1]]={methods:[t],details:i,options:s})})),e}(e)),e.payment_system&&Object.keys(e.provider).length>0?(this.element.classList.remove("pending"),this.element.classList.add("ready"),this.connector.send("show",{})):this.connector.send("hide",{})}))),this.connector.on("event",this.proxy((function(t,e){"mouseenter"===e.type&&this.element.classList.add("hover"),"mouseleave"===e.type&&this.element.classList.remove("hover"),"focusin"===e.type&&this.element.classList.add("active"),"focusout"===e.type&&this.element.classList.remove("active")})))}});var re={},oe={},ae=j.Api;oe.Widget=ae.extend({init:function(t){this.initParams(t),this.initWidget()},initWidget:function(){this.initOptions(this.params.options),this.utils.isString(this.params.element)&&this.initElement(this.params.element)},initOptions:function(){this.utils.isPlainObject(this.params.options)&&(this.params.options=this.params.options||{})},initElement:function(t){},addSelectorEvent:function(t,e,n){return this.each(this.utils.querySelectorAll(t),(function(t,i){this.addEvent(i,e,n)})),this},getRequestParams:function(){return{}},sendRequest:function(t,e){e.defaultPrevented||(e.preventDefault(),this.trigger("request",this.getRequestParams(t)),this.scope((function(){this.request("api.checkout.form","request",this.getRequestParams(t)).done(this.proxy("onSuccess")).fail(this.proxy("onError")).progress(this.proxy("onProgress"))})))},onProgress:function(t,e){this.trigger("progress",e)},onSuccess:function(t,e){e.sendResponse(),e.submitToMerchant(),this.trigger("success",e)},onError:function(t,e){this.trigger("error",e)}});var he=T.Module,ue=oe.Widget,de=he.extend({init:function(t){this.setFormElement(t)},setFormElement:function(t){this.utils.isElement(t)&&(this.form=t)},getData:function(t){var e=this.deparam(this.serializeArray());return!0===t?this.utils.cleanObject(e):e},serializeArray:function(){var t=this.utils.toArray(this.form.elements);return this.utils.map(t,(function(t){if(!t.disabled&&""!==t.name&&(!t.type.match("checkbox|radio")||t.checked))return{name:t.name,value:t.value}}))},serializeAndEncode:function(){return this.utils.map(this.serializeArray(),(function(t){return[t.name,encodeURIComponent(t.value)].join("=")})).join("&")},deparam:function(t){var e,n={},i=/[^\[\]]+|\[\]$/g,s=function(t,e){var i,s=n,r=t.pop(),o=t.length;for(i=0;i<o;i++)s[t[i]]||(s[t[i]]=o===i+1&&"[]"===r?[]:{}),s=s[t[i]];"[]"===r?s.push(e):s[r]=e};for(e in t)t.hasOwnProperty(e)&&s(t[e].name.match(i),t[e].value);return n}});re.WidgetForm=ue.extend({initElement:function(t){this.addSelectorEvent(t,"submit","sendRequest")},getRequestParams:function(t){return this.utils.extend({},this.params.options,new de(t).getData())}});var le={},ce=oe.Widget;return le.WidgetButton=ce.extend({attributes:{},initElement:function(t){this.utils.isPlainObject(this.params.attributes)&&this.utils.extend(this.attributes,this.params.attributes),this.addSelectorEvent(t,"click","sendRequest")},getRequestParams:function(t){return this.utils.extend({},this.params.options,this.getElementData(t))},getElementData:function(t){var e={};return this.utils.forEach(this.attributes,(function(n,i){t.hasAttribute(i)&&(e[n]=t.getAttribute(i))})),e}}),function(t,e){var i=n.Component,s=d,r=R,o=j.Api,a=T.Module,h=$.Connector,u=st.Response,l=ft.PaymentButton,c=gt.PaymentRequestApi,p=Wt.PaymentElement,m=Xt.PaymentContainer,f=re.WidgetForm,g=le.WidgetButton;i.add("Api",o),i.add("Connector",h),i.add("PaymentButton",l),i.add("PaymentRequestApi",c),i.add("PaymentElement",p),i.add("FormWidget",f),i.add("ButtonWidget",g),i.Utils=e.Utils=s,i.Config=e.Config=r,i.Api=e.Api=o,i.Module=e.Module=a,i.Connector=e.Connector=h,i.PaymentRequestApi=e.PaymentRequestApi=c,i.PaymentContainer=e.PaymentContainer=m,i.PaymentElement=e.PaymentElement=p,i.PaymentButton=e.PaymentButton=l,i.Response=e.Response=u,t.exports=i}(e,e.exports),t(e.exports)}));
//# sourceMappingURL=checkout.min.js.map
